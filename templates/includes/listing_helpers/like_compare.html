{% load static %}

<div class="d-flex justify-content-end"> 
  <!--TO DO: COMPARE LISTING <img class="me-2" {% if request.path != '/oglasi/' %} hidden {% endif %} src="{% static 'images/shared/actionitem-compare.svg' %}" alt="Compare item" width="21px"> -->
  <input hidden id="token" value="{{ csrf_token }}" >
  {% if user.id in listing.likes %}
      <img class="isLiked{{listing.id}}" src="{% static 'images/items/HearthFilled.svg' %}" alt="Liked" width="25px" height="25px" {% if user.id is not None %} onclick="addRemoveFavorites('{{listing.id}}')" {% else %} data-bs-target="#accountModal" data-bs-toggle="modal"{% endif %} >
      {% else %}
      <img class="isLiked{{listing.id}}" src="{% static 'images/icons/hearth.svg' %}" alt="Like" width="22px" height="22px" {% if user.id is not None %} onclick="addRemoveFavorites('{{listing.id}}')" {% else %} data-bs-target="#accountModal" data-bs-toggle="modal"{% endif %} >
    {% endif %}
</div>
<script>
  function addRemoveFavorites(id) {
    let url = "{% url 'listing_add_remove_favorites' %}"
    let csrftoken =  document.getElementById('token').value;
    let headers = new Headers();
    headers.append("Content-Type", "application/json");
    headers.append("X-CSRFToken", csrftoken);
    fetch(`${url}`, {
        method: "POST",
        headers: headers,
        body: JSON.stringify({
          id,
        })
    })
    .then(response => {
      if (response.status === 200) {
        return response.json()
      } else {
        throw new Error('Something went wrong')
      }
    }).then(data => {
      if (data) {
        const like = document.getElementsByClassName(`isLiked${id}`)
        for (let i = 0; i < like.length; i++) {
          like[i].src = `{% static 'images/items/HearthFilled.svg' %}`
        }
      } else {
        const unlike = document.getElementsByClassName(`isLiked${id}`)
        for (let i = 0; i < unlike.length; i++) {
          unlike[i].src = `{% static 'images/icons/hearth.svg' %}`
        }
      }
    })
  }
</script>